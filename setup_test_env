#!/bin/bash -x
yell() { echo "$0: $*" >&2; }
die() { yell "$*"; exit 111; }
try() { echo "$@"; "$@" || die "FAILED $*"; }

try cd "$TEST_DIR/$PROJECT"
try git clean -f -d
try git pull
ci_branch="dbox_ci"
#ci_branch="master"
if [ "$1" = "" ]; then
    branch="$ci_branch"
else
    branch=$1
fi
try git checkout "$branch"
try git clean -f -d
try git pull
if [ "$branch" != "$ci_branch" ]; then
  try cd build/jenkins
  for F in $(cat "$TEST_DIR/jenkins_scripts"); do
    try git checkout "$ci_branch $F"
  done
fi
