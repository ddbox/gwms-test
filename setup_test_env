#!/bin/bash
yell() { echo "$0: $*" >&2; }
die() { yell "$*"; exit 111; }
try() { echo "$@"; "$@" || die "FAILED $*"; }

try cd "$TEST_DIR"
rm -rf output || true
mkdir -p output
rm -rf $PROJECT || true
try git clone https://github.com/glideinWMS/glideinwms.git 
try cd "$PROJECT"
ci_branch="dbox_ci"
if [ "$1" = "" ]; then
    branch="$master"
else
    branch=$1
fi
try git checkout -f  "$ci_branch"
cd build/jenkins
FILES=*
try git checkout -f "$branch"
if [ "$branch" != "$ci_branch" ]; then
  try cd build/jenkins
  for F in $FILES; do
    try git checkout -f "$ci_branch" "$F"
  done
fi
try cd $TEST_DIR
source glideinwms/build/jenkins/utils.sh
setup_python_venv
